
โครงการนี้สาธิตวิธีการสร้างเครื่องตรวจจับควันโดยใช้บอร์ด ESP32 และเซ็นเซอร์ MQ-2 เมื่อระดับควันมีความเข้มข้นเกินกว่าเกณฑ์ที่กำหนด ระบบจะทำการโทรศัพท์แจ้งเตือนไปยังเบอร์ที่ตั้งค่าไว้โดยอัตโนมัติผ่าน Twilio Programmable Voice API นอกจากนี้ยังมีการเชื่อมต่อกับ Arduino IoT Cloud เพื่อดูข้อมูลแบบเรียลไทม์ และส่งข้อมูลไปบันทึกที่ Google Sheets ผ่าน Apps Script
คุณสมบัติหลัก

    ตรวจจับความเข้มข้นของควันแบบเรียลไทม์ด้วยเซ็นเซอร์ MQ-2
    เชื่อมต่อและแสดงผลข้อมูลบน Dashboard ของ Arduino IoT Cloud
    โทรแจ้งเตือนอัตโนมัติเมื่อระดับควันเกินเกณฑ์ที่กำหนดผ่าน Twilio Voice API
    (เสริม) สามารถส่งข้อมูลเพื่อบันทึกลงใน Google Sheets ได้

สิ่งที่ต้องเตรียม (Prerequisites)
ฮาร์ดแวร์ (Hardware)

    บอร์ดพัฒนา ESP32
    เซ็นเซอร์ตรวจจับควันและแก๊ส MQ-2
    สายไฟเชื่อมต่อ (Jumper Wires)
    Breadboard

ซอฟต์แวร์และบริการ (Software & Services)

    Arduino IDE พร้อมติดตั้ง ESP32 Board Manager
    Library ที่จำเป็น:
        ArduinoIoTCloud
        Arduino_ConnectionHandler
        MQUnifiedsensor
        HTTPClient (มาพร้อมกับ ESP32 Core)
    บัญชี Arduino IoT Cloud
    บัญชี Twilio (แผนใช้งานฟรีก็เพียงพอสำหรับการทดสอบ)
    บัญชี Google (หากต้องการใช้ฟังก์ชันบันทึกข้อมูลลง Google Sheets)

ขั้นตอนการตั้งค่า (Setup and Configuration)

โปรดดำเนินการตามขั้นตอนต่อไปนี้เพื่อตั้งค่าและรวบรวมข้อมูลที่จำเป็นทั้งหมดก่อนการคอมไพล์โค้ด
1. การตั้งค่า Twilio (Twilio Configuration)

ส่วนนี้เป็นหัวใจสำคัญของการแจ้งเตือนด้วยเสียง คุณจำเป็นต้องตั้งค่าและดึงข้อมูลจากบัญชี Twilio ของคุณ
1.1) รวบรวมข้อมูลประจำตัว (Credentials)

ก่อนอื่น ให้เข้าสู่ระบบบัญชี Twilio ของคุณและไปที่ Account Dashboard เพื่อรวบรวมข้อมูล 3 ส่วนหลัก:

    Account SID: รหัสเฉพาะสำหรับบัญชีของคุณ
    Auth Token: โทเค็นสำหรับยืนยันตัวตน (เปรียบเสมือนรหัสผ่าน)
    Your Twilio Phone Number: เบอร์โทรศัพท์ที่ซื้อหรือได้รับจาก Twilio เพื่อใช้เป็นเบอร์ผู้ส่ง

1.2) สร้าง TwiML Bin สำหรับข้อความเสียง

TwiML (Twilio Markup Language) คือชุดคำสั่งในรูปแบบ XML ที่บอกให้ Twilio ทราบว่าต้องทำอะไรเมื่อมีการโทรออก (เช่น พูดข้อความ, เล่นไฟล์เสียง, หรือโอนสาย) ในโครงการนี้ เราจะใช้ TwiML เพื่อสั่งให้ระบบพูดข้อความแจ้งเตือน

    ไปที่หน้า TwiML Bins ใน Console ของ Twilio

    คลิกปุ่ม + เพื่อสร้าง TwiML Bin ใหม่
    ตั้งชื่อ (Friendly Name) ที่สื่อความหมาย เช่น Smoke Alert Message
    ในส่วนของ TwiML ให้ใส่โค้ด XML เพื่อสร้างข้อความเสียง ตัวอย่างเช่น:
    XML

    <Response>
        <Say language="th-TH" voice="Polly.Salli">
            คำเตือน, ตรวจพบควันในระดับที่เป็นอันตราย กรุณาตรวจสอบพื้นที่ของคุณทันที
        </Say>
        <Hangup/>
    </Response>

        <Say>: คือคำสั่งให้พูดข้อความ คุณสามารถเปลี่ยน language เป็น en-US สำหรับภาษาอังกฤษ หรือภาษาอื่นๆ ที่รองรับ
        <Hangup/>: คือคำสั่งให้วางสายหลังจากพูดจบ
    บันทึก TwiML Bin ของคุณ
    หลังจากบันทึก Twilio จะสร้าง URL สำหรับ TwiML Bin นี้ ให้คัดลอก URL ดังกล่าว เพื่อนำไปใช้ในขั้นตอนถัดไป

1.3) เตรียมเบอร์โทรศัพท์ผู้รับสาย

    เตรียมเบอร์โทรศัพท์ที่คุณต้องการให้ระบบโทรแจ้งเตือน
    สำคัญ: เบอร์โทรศัพท์จะต้องอยู่ใน รูปแบบสากล (E.164 format) ซึ่งประกอบด้วยเครื่องหมาย + ตามด้วยรหัสประเทศ และเบอร์โทรศัพท์ (โดยไม่ต้องมีเลข 0 นำหน้า)
        ตัวอย่างสำหรับประเทศไทย: +66812345678

2. การตั้งค่าไฟล์ secrets.h

หลังจากได้ข้อมูลทั้งหมดจากขั้นตอนข้างต้นแล้ว ให้เปิดไฟล์ secrets.h ในโปรเจกต์ Arduino ของคุณ และกรอกข้อมูลทั้งหมดให้ถูกต้อง

3. การตั้งค่าอื่นๆ

    Arduino IoT Cloud: ตั้งค่า "Thing" และ "Device" ของคุณใน Arduino IoT Cloud เพื่อรับ DEVICE_LOGIN_NAME และ DEVICE_KEY
    Google Apps Script: หากต้องการใช้งาน ให้สร้างโปรเจกต์ Apps Script และ Deploy เป็น Web App เพื่อรับ APPS_SCRIPT_URL

การใช้งาน

    ตรวจสอบว่าได้กรอกข้อมูลในไฟล์ secrets.h ครบถ้วนและถูกต้องแล้ว
    เชื่อมต่อบอร์ด ESP32 เข้ากับคอมพิวเตอร์
    เลือก Board และ Port ที่ถูกต้องใน Arduino IDE
    คอมไพล์และอัปโหลดโค้ดไปยังบอร์ด ESP32
    เปิด Serial Monitor (Baud rate: 115200) เพื่อดูสถานะการทำงาน, การเชื่อมต่อ, และค่าที่อ่านได้จากเซ็นเซอร์

เมื่อระบบทำงานและตรวจพบควันเกินค่า SMOKE_THRESHOLD_PPM ที่ตั้งไว้ คุณจะได้รับการโทรแจ้งเตือนจากเบอร์ Twilio ของคุณ พร้อมข้อความเสียงตามที่ได้ตั้งค่าไว้ใน TwiML Bin
